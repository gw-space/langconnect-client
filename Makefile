.PHONY: build up down restart mcp test dev up-dev down-dev

build:
	@echo "ðŸ”¨ Building Next.js application..."
	@cd next-connect-ui && npm install && npm run build
	@echo "âœ… Next.js build completed!"
	@echo ""
	@echo "ðŸ”¨ Building Docker images..."
	@docker compose build --no-cache
	@echo "âœ… Docker build completed successfully!"
	@echo "ðŸ“Œ Run 'make up' to start the server"

up:
	@echo "ðŸš€ Starting LangConnect server..."
	@docker compose up -d
	@echo "âœ… Server started successfully!"
	@echo "ðŸ“Œ Access points:"
	@echo "   - API Server: http://localhost:8080"
	@echo "   - API Docs: http://localhost:8080/docs"
	@echo "   - Next.js UI: http://localhost:3001"
	@echo "   - PostgreSQL: localhost:5432"

up-build:
	@echo "ðŸ”¨ Building and starting LangConnect server..."
	@docker compose build --no-cache
	@docker compose up -d
	@echo "âœ… Server built and started successfully!"
	@echo "ðŸ“Œ Access points:"
	@echo "   - API Server: http://localhost:8080"
	@echo "   - API Docs: http://localhost:8080/docs"
	@echo "   - Next.js UI: http://localhost:3001"
	@echo "   - PostgreSQL: localhost:5432"

down:
	@echo "ðŸ›‘ Stopping LangConnect server..."
	@docker compose down
	@echo "âœ… Server stopped successfully!"

restart:
	@echo "ðŸ”„ Restarting LangConnect server..."
	@docker compose down
	@docker compose up -d
	@echo "âœ… Server restarted successfully!"

mcp:
	@echo "ðŸ”§ Creating MCP configuration..."
	@uv run python mcpserver/create_mcp_json.py
	@echo "âœ… MCP configuration created successfully!"

TEST_FILE ?= tests/unit_tests

test:
	./run_tests.sh $(TEST_FILE)

dev:
	@echo "ðŸš€ Starting LangConnect in development mode..."
	@docker compose -f docker-compose.dev.yml up -d
	@echo "âœ… Development server started successfully!"
	@echo "ðŸ“Œ Access points:"
	@echo "   - API Server: http://localhost:8000"
	@echo "   - API Docs: http://localhost:8000/docs"
	@echo "   - Next.js UI: http://localhost:3001 (with hot reload)"
	@echo "   - PostgreSQL: localhost:5432"

up-dev:
	@echo "ðŸš€ Starting LangConnect in development mode..."
	@docker compose -f docker-compose.dev.yml up -d
	@echo "âœ… Development server started successfully!"
	@echo "ðŸ“Œ Access points:"
	@echo "   - API Server: http://localhost:8000"
	@echo "   - API Docs: http://localhost:8000/docs"
	@echo "   - Next.js UI: http://localhost:3001 (with hot reload)"
	@echo "   - PostgreSQL: localhost:5432"

down-dev:
	@echo "ðŸ›‘ Stopping LangConnect development server..."
	@docker compose -f docker-compose.dev.yml down
	@echo "âœ… Development server stopped successfully!"

